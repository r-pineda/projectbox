<ActionBar title="">
    <GridLayout rows="*,*,*" columns="*">
        <Label class="fa" (tap)="nav.openDrawer()" [text]="'fa-bars' | fonticon" ios:horizontalAlignment="left"
               android:horizontalAlignment="left" row="0" col="0"></Label>
        <Label text="Task-Detailansicht" class="nav-h3" row="0" col="1"></Label>
    </GridLayout>
</ActionBar>
<ScrollView tkMainContent orientation="vertical" isEnabled="true" width="100%" height="100%">
    <AbsoluteLayout>
        <StackLayout class="page" width="100%">
            <StackLayout class="form-taskticket">
                <Label class="fa" [text]="'fa-angle-down' | fonticon" horizontalAlignment="center"></Label>
                <Label class="h5" text="Titel"></Label>
                <TextField class="textfield" [(ngModel)]="todo.name"></TextField>
                <Label class="h5" text="Deadline"></Label>
                <TextField class="textfield" hint="DD.MM.YYYY" [(ngModel)]="todo.due_date"></TextField>
                <Label class="h5" text="Projekt"></Label>
                <!--<TextField class="textfield" [(ngModel)]="todo.project"></TextField>-->
                <DropDown #dd
                          style="padding: 5;font-size: 15;background-color: #EBEBEB;margin-bottom:15;"
                          [items]="projectNames"
                          [selectedIndex]="selectedProject"
                          (selectedIndexChanged)="getPhases($event)"
                          (opened)="onopen()"
                          (closed)="getPhases()"></DropDown>
                <Label class="h5" text="Phase"></Label>
                <DropDown #phasedd
                          style="padding: 5;font-size: 15;background-color: #EBEBEB;margin-bottom:15;"
                          [items]="phaseSelection"
                          (selectedIndexChanged)="selectPhase($event)"
                          (opened)="onopen()" A
                          (closed)="onclose()"></DropDown>
                <Label class="h5" text="Verantwortlicher"></Label>
                <TextField class="textfield" [(ngModel)]="todo.user"></TextField>
                <Label class="h5" text="Beschreibung"></Label>
                <TextView [(ngModel)]="todo.description" height="200" returnKeyType="send" class="input textfield"></TextView>
                <Label class="field-seperator margin-topbot-10" height="1"></Label>
                <GridLayout columns="*,*" rows="*,*">
                    <Image [src]="task_tabs == 'timetracking' ? '~/images/timetracking_t.png' : '~/images/timetracking_g.png'"
                           (tap)="state('timetracking')" row="0" col="0" width="20"
                           height="20"
                           stretch="aspectFit"></Image>
                    <Image [src]="task_tabs == 'kommentare' ? '~/images/kommentare_t.png' : '~/images/kommentare_g.png'"
                           (tap)="state('kommentare')" row="0" col="1" width="40"
                           height="20"
                           stretch="aspectFit"></Image>
                    <Label class="h4" text="Timetracking"
                           [style.color]="task_tabs == 'timetracking' ? '#03A698' : '#222222'"
                           (tap)="state('timetracking')" col="0" row="1"
                           horizontalAlignment="center"></Label>
                    <Label class="h4" text="Kommentare"
                           [style.color]="task_tabs == 'kommentare' ? '#03A698' : '#222222'" (tap)="state('kommentare')"
                           col="1" row="1"
                           horizontalAlignment="center"></Label>
                </GridLayout>
                <Label class="field-seperator margin-topbot-10" height="1"></Label>
                <StackLayout [ngSwitch]="task_tabs">
                    <StackLayout *ngSwitchCase="'timetracking'">
                        <GridLayout columns="*,*" rows="*, *" class="time-entry">
                            <Label class="h4" col="0" row="0" text="Gesamtdauer"></Label>
                            <Label class="h4" col="1" row="0" text="00:00:00" horizontalAlignment="right"></Label>
                            <StackLayout colSpan="2" row="1">
                                <StackLayout *ngFor="let tracking of trackings">
                                <Label class="field-seperator" height="1"></Label>
                                <StackLayout orientation="horizontal" class="bg-gray">
                                    <Label [text]="tracking.created_at"
                                           horizontalAlignment="right"></Label>
                                </StackLayout>
                                <Label class="field-seperator" height="1"></Label>
                                <GridLayout columns="auto,*" row="*">
                                    <StackLayout orientation="horizontal" row="0" col="0">
                                    <Label [text]="tracking.started_at"></Label>
                                    <Label text=" - "></Label>
                                    <Label [text]="tracking.finished_at"></Label>
                                    </StackLayout>
                                    <StackLayout orientation="horizontal" row="0" col="1" horizontalAlignment="right">
                                    <Label [text]="tracking.timerString" [class]="isPL == 'true' ? 'margin-right-10' : '' " ></Label>
                                    <Label class="fa" [text]="'fa-times' | fonticon" (tap)="deleteTracking(todo.id)" *ngIf="isPL"></Label>
                                    </StackLayout>
                                </GridLayout>
                                </StackLayout>
                            </StackLayout>
                        </GridLayout>
                    </StackLayout>
                <StackLayout *ngSwitchCase="'kommentare'">
                    <StackLayout>
                        <!--<GridLayout rows="auto, auto" columns="auto, *">-->
                            <GridLayout rows="auto, auto" columns="auto, *" *ngFor="let comment of todo.comments">
                            <Image [src]='comment.userImage' width="30" height="30"
                                   stretch="aspectFit" rowSpan="1" col="0"></Image>
                            <Label [text]="comment.message" editable="false"
                                      textWrap="true"
                                      class="longtext h4" col="1"
                                      row="0"></Label>
                            <Label [text]="comment.date" col="1" row="1"></Label>
                            </GridLayout>
                        <!--</GridLayout>-->
                        <GridLayout rows="auto" columns="auto, *, auto">
                            <Image src='~/images/user.png' width="30" height="30"
                                   stretch="aspectFit" row="0" col="0"></Image>
                            <TextField class="textfield" hint="Kommentieren" [(ngModel)]="newComment.message"
                                       col="1" row="0"></TextField>
                            <StackLayout class="btn-img margin-left-10" (tap)="createComment()" row="0"
                                         col="2">
                                <Image src="~/images/send.png" width="30" height="30" stretch="aspectFit"></Image>
                            </StackLayout>
                        </GridLayout>
                    </StackLayout>
                </StackLayout>
            </StackLayout>
            <Label class="field-seperator margin-topbot-10" height="1"></Label>
            <StackLayout orientation="horizontal" horizontalAlignment="right">
                <StackLayout class="btn-img" (tap)="cancel()">
                    <Image src="~/images/abbrechen2.png" width="30" height="30" stretch="aspectFit"></Image>
                </StackLayout>
                <StackLayout class="btn-img" (tap)="createTodo()">
                    <Image src="~/images/save.png" width="30" height="30" stretch="aspectFit"></Image>
                </StackLayout>
            </StackLayout>
        </StackLayout>
        </StackLayout>
    </AbsoluteLayout>
</ScrollView>